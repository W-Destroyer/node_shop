{"version":3,"sources":["node_modules/history/lib/createHistory.js"],"names":["exports","__esModule","_AsyncUtils","require","_PathUtils","_runTransitionHook","_runTransitionHook2","_interopRequireDefault","_Actions","_LocationUtils","obj","default","createHistory","options","arguments","length","undefined","getCurrentLocation","getUserConfirmation","pushLocation","replaceLocation","go","keyLength","currentLocation","pendingLocation","beforeListeners","listeners","allKeys","getCurrentIndex","action","POP","indexOf","key","updateLocation","nextLocation","currentIndex","PUSH","concat","slice","REPLACE","forEach","listener","listenBefore","push","filter","item","listen","confirmTransitionTo","location","callback","loopAsync","index","next","done","result","message","ok","transitionTo","locationsAreEqual","prevPath","createPath","nextPath","statesAreEqual","state","prevIndex","nextIndex","input","createLocation","replace","goBack","goForward","createKey","Math","random","toString","substr","createHref"],"mappings":"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","file":"createHistory.js","sourceRoot":"/Users/creator/workspace/furuida","sourcesContent":["'use strict';\n\nexports.__esModule = true;\n\nvar _AsyncUtils = require('./AsyncUtils');\n\nvar _PathUtils = require('./PathUtils');\n\nvar _runTransitionHook = require('./runTransitionHook');\n\nvar _runTransitionHook2 = _interopRequireDefault(_runTransitionHook);\n\nvar _Actions = require('./Actions');\n\nvar _LocationUtils = require('./LocationUtils');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar createHistory = function createHistory() {\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var getCurrentLocation = options.getCurrentLocation,\n      getUserConfirmation = options.getUserConfirmation,\n      pushLocation = options.pushLocation,\n      replaceLocation = options.replaceLocation,\n      go = options.go,\n      keyLength = options.keyLength;\n\n\n  var currentLocation = void 0;\n  var pendingLocation = void 0;\n  var beforeListeners = [];\n  var listeners = [];\n  var allKeys = [];\n\n  var getCurrentIndex = function getCurrentIndex() {\n    if (pendingLocation && pendingLocation.action === _Actions.POP) return allKeys.indexOf(pendingLocation.key);\n\n    if (currentLocation) return allKeys.indexOf(currentLocation.key);\n\n    return -1;\n  };\n\n  var updateLocation = function updateLocation(nextLocation) {\n    var currentIndex = getCurrentIndex();\n\n    currentLocation = nextLocation;\n\n    if (currentLocation.action === _Actions.PUSH) {\n      allKeys = [].concat(allKeys.slice(0, currentIndex + 1), [currentLocation.key]);\n    } else if (currentLocation.action === _Actions.REPLACE) {\n      allKeys[currentIndex] = currentLocation.key;\n    }\n\n    listeners.forEach(function (listener) {\n      return listener(currentLocation);\n    });\n  };\n\n  var listenBefore = function listenBefore(listener) {\n    beforeListeners.push(listener);\n\n    return function () {\n      return beforeListeners = beforeListeners.filter(function (item) {\n        return item !== listener;\n      });\n    };\n  };\n\n  var listen = function listen(listener) {\n    listeners.push(listener);\n\n    return function () {\n      return listeners = listeners.filter(function (item) {\n        return item !== listener;\n      });\n    };\n  };\n\n  var confirmTransitionTo = function confirmTransitionTo(location, callback) {\n    (0, _AsyncUtils.loopAsync)(beforeListeners.length, function (index, next, done) {\n      (0, _runTransitionHook2.default)(beforeListeners[index], location, function (result) {\n        return result != null ? done(result) : next();\n      });\n    }, function (message) {\n      if (getUserConfirmation && typeof message === 'string') {\n        getUserConfirmation(message, function (ok) {\n          return callback(ok !== false);\n        });\n      } else {\n        callback(message !== false);\n      }\n    });\n  };\n\n  var transitionTo = function transitionTo(nextLocation) {\n    if (currentLocation && (0, _LocationUtils.locationsAreEqual)(currentLocation, nextLocation) || pendingLocation && (0, _LocationUtils.locationsAreEqual)(pendingLocation, nextLocation)) return; // Nothing to do\n\n    pendingLocation = nextLocation;\n\n    confirmTransitionTo(nextLocation, function (ok) {\n      if (pendingLocation !== nextLocation) return; // Transition was interrupted during confirmation\n\n      pendingLocation = null;\n\n      if (ok) {\n        // Treat PUSH to same path like REPLACE to be consistent with browsers\n        if (nextLocation.action === _Actions.PUSH) {\n          var prevPath = (0, _PathUtils.createPath)(currentLocation);\n          var nextPath = (0, _PathUtils.createPath)(nextLocation);\n\n          if (nextPath === prevPath && (0, _LocationUtils.statesAreEqual)(currentLocation.state, nextLocation.state)) nextLocation.action = _Actions.REPLACE;\n        }\n\n        if (nextLocation.action === _Actions.POP) {\n          updateLocation(nextLocation);\n        } else if (nextLocation.action === _Actions.PUSH) {\n          if (pushLocation(nextLocation) !== false) updateLocation(nextLocation);\n        } else if (nextLocation.action === _Actions.REPLACE) {\n          if (replaceLocation(nextLocation) !== false) updateLocation(nextLocation);\n        }\n      } else if (currentLocation && nextLocation.action === _Actions.POP) {\n        var prevIndex = allKeys.indexOf(currentLocation.key);\n        var nextIndex = allKeys.indexOf(nextLocation.key);\n\n        if (prevIndex !== -1 && nextIndex !== -1) go(prevIndex - nextIndex); // Restore the URL\n      }\n    });\n  };\n\n  var push = function push(input) {\n    return transitionTo(createLocation(input, _Actions.PUSH));\n  };\n\n  var replace = function replace(input) {\n    return transitionTo(createLocation(input, _Actions.REPLACE));\n  };\n\n  var goBack = function goBack() {\n    return go(-1);\n  };\n\n  var goForward = function goForward() {\n    return go(1);\n  };\n\n  var createKey = function createKey() {\n    return Math.random().toString(36).substr(2, keyLength || 6);\n  };\n\n  var createHref = function createHref(location) {\n    return (0, _PathUtils.createPath)(location);\n  };\n\n  var createLocation = function createLocation(location, action) {\n    var key = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : createKey();\n    return (0, _LocationUtils.createLocation)(location, action, key);\n  };\n\n  return {\n    getCurrentLocation: getCurrentLocation,\n    listenBefore: listenBefore,\n    listen: listen,\n    transitionTo: transitionTo,\n    push: push,\n    replace: replace,\n    go: go,\n    goBack: goBack,\n    goForward: goForward,\n    createKey: createKey,\n    createPath: _PathUtils.createPath,\n    createHref: createHref,\n    createLocation: createLocation\n  };\n};\n\nexports.default = createHistory;"]}